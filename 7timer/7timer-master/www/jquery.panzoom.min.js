(function(b,a){if(typeof define==="function"&&define.amd){define(["jquery"],function(c){return a(b,c)})}else{if(typeof exports==="object"){a(b,require("jquery"))}else{a(b,b.jQuery)}}}(typeof window!=="undefined"?window:this,function(j,c){var k=j.document;var d="__pz__";var n=Array.prototype.slice;var q=/trident\/7./i;var b=(function(){if(q.test(navigator.userAgent)){return false}var r=k.createElement("input");r.setAttribute("oninput","return");return typeof r.oninput==="function"})();var o=/([A-Z])/g;var l=/^http:[\w\.\/]+svg$/;var i="(\\-?\\d[\\d\\.e-]*)";var p="\\,?\\s*";var h=new RegExp("^matrix\\("+i+p+i+p+i+p+i+p+i+p+i+"\\)$");function g(t,r){var s=t.length;while(--s){if(Math.round(+t[s])!==Math.round(+r[s])){return false}}return true}function m(s){var r={range:true,animate:true};if(typeof s==="boolean"){r.animate=s}else{c.extend(r,s)}return r}function a(z,y,x,w,v,u,t,s,r){if(c.type(z)==="array"){this.elements=[+z[0],+z[2],+z[4],+z[1],+z[3],+z[5],0,0,1]}else{this.elements=[z,y,x,w,v,u,t||0,s||0,r||1]}}a.prototype={x:function(t){var u=t instanceof e;var s=this.elements,r=t.elements;if(u&&r.length===3){return new e(s[0]*r[0]+s[1]*r[1]+s[2]*r[2],s[3]*r[0]+s[4]*r[1]+s[5]*r[2],s[6]*r[0]+s[7]*r[1]+s[8]*r[2])}else{if(r.length===s.length){return new a(s[0]*r[0]+s[1]*r[3]+s[2]*r[6],s[0]*r[1]+s[1]*r[4]+s[2]*r[7],s[0]*r[2]+s[1]*r[5]+s[2]*r[8],s[3]*r[0]+s[4]*r[3]+s[5]*r[6],s[3]*r[1]+s[4]*r[4]+s[5]*r[7],s[3]*r[2]+s[4]*r[5]+s[5]*r[8],s[6]*r[0]+s[7]*r[3]+s[8]*r[6],s[6]*r[1]+s[7]*r[4]+s[8]*r[7],s[6]*r[2]+s[7]*r[5]+s[8]*r[8])}}return false},inverse:function(){var s=1/this.determinant(),r=this.elements;return new a(s*(r[8]*r[4]-r[7]*r[5]),s*(-(r[8]*r[1]-r[7]*r[2])),s*(r[5]*r[1]-r[4]*r[2]),s*(-(r[8]*r[3]-r[6]*r[5])),s*(r[8]*r[0]-r[6]*r[2]),s*(-(r[5]*r[0]-r[3]*r[2])),s*(r[7]*r[3]-r[6]*r[4]),s*(-(r[7]*r[0]-r[6]*r[1])),s*(r[4]*r[0]-r[3]*r[1]))},determinant:function(){var r=this.elements;return r[0]*(r[8]*r[4]-r[7]*r[5])-r[3]*(r[8]*r[1]-r[7]*r[2])+r[6]*(r[5]*r[1]-r[4]*r[2])}};function e(r,t,s){this.elements=[r,t,s]}e.prototype.e=a.prototype.e=function(r){return this.elements[r]};function f(v,t){if(!(this instanceof f)){return new f(v,t)}if(v.nodeType!==1){c.error("Panzoom called on non-Element node")}if(!c.contains(k,v)){c.error("Panzoom element must be attached to the document")}var w=c.data(v,d);if(w){return w}this.options=t=c.extend({},f.defaults,t);this.elem=v;var s=this.$elem=c(v);this.$set=t.$set&&t.$set.length?t.$set:s;this.$doc=c(v.ownerDocument||k);this.$parent=s.parent();this.parent=this.$parent[0];this.isSVG=l.test(v.namespaceURI)&&v.nodeName.toLowerCase()!=="svg";this.panning=false;this._buildTransform();this._transform=c.cssProps.transform.replace(o,"-$1").toLowerCase();this._buildTransition();this.resetDimensions();var u=c();var r=this;c.each(["$zoomIn","$zoomOut","$zoomRange","$reset"],function(y,x){r[x]=t[x]||u});this.enable();this.scale=this.getMatrix()[0];this._checkPanWhenZoomed();c.data(v,d,this)}f.rmatrix=h;f.defaults={eventNamespace:".panzoom",transition:true,cursor:"move",disablePan:false,disableZoom:false,disableXAxis:false,disableYAxis:false,which:1,increment:0.3,linearZoom:false,panOnlyWhenZoomed:false,minScale:0.3,maxScale:6,rangeStep:0.05,duration:200,easing:"ease-in-out",contain:false};f.prototype={constructor:f,instance:function(){return this},enable:function(){this._initStyle();this._bind();this.disabled=false},disable:function(){this.disabled=true;this._resetStyle();this._unbind()},isDisabled:function(){return this.disabled},destroy:function(){this.disable();c.removeData(this.elem,d)},resetDimensions:function(){this.container=this.parent.getBoundingClientRect();var r=this.elem;var s=r.getBoundingClientRect();var t=Math.abs(this.scale);this.dimensions={width:s.width,height:s.height,left:c.css(r,"left",true)||0,top:c.css(r,"top",true)||0,border:{top:c.css(r,"borderTopWidth",true)*t||0,bottom:c.css(r,"borderBottomWidth",true)*t||0,left:c.css(r,"borderLeftWidth",true)*t||0,right:c.css(r,"borderRightWidth",true)*t||0},margin:{top:c.css(r,"marginTop",true)*t||0,left:c.css(r,"marginLeft",true)*t||0}}},reset:function(s){s=m(s);var r=this.setMatrix(this._origTransform,s);if(!s.silent){this._trigger("reset",r)}},resetZoom:function(s){s=m(s);var r=this.getMatrix(this._origTransform);s.dValue=r[3];this.zoom(r[0],s)},resetPan:function(s){var r=this.getMatrix(this._origTransform);this.pan(r[4],r[5],m(s))},setTransform:function(s){var r=this.$set;var t=r.length;while(t--){c.style(r[t],"transform",s);if(this.isSVG){r[t].setAttribute("transform",s)}}},getTransform:function(s){var r=this.$set;var t=r[0];if(s){this.setTransform(s)}else{s=c.style(t,"transform");if(this.isSVG&&(!s||s==="none")){s=c.attr(t,"transform")||"none"}}if(s!=="none"&&!h.test(s)){this.setTransform(s=c.css(t,"transform"))}return s||"none"},getMatrix:function(s){var r=h.exec(s||this.getTransform());if(r){r.shift()}return r||[1,0,0,1,0,0]},setMatrix:function(D,s){if(this.disabled){return}if(!s){s={}}if(typeof D==="string"){D=this.getMatrix(D)}var H=+D[0];
var G=typeof s.contain!=="undefined"?s.contain:this.options.contain;if(G){var B=s.dims;if(!B){this.resetDimensions();B=this.dimensions}var v,A,E;var y=this.container;var C=B.width;var z=B.height;var t=y.width;var w=y.height;var I=t/C;var u=w/z;if(this.$parent.css("textAlign")!=="center"||c.css(this.elem,"display")!=="inline"){E=(C-this.elem.offsetWidth)/2;v=E-B.border.left;A=C-t-E+B.border.right}else{v=A=((C-t)/2)}var x=((z-w)/2)+B.border.top;var r=((z-w)/2)-B.border.top-B.border.bottom;if(G==="invert"||G==="automatic"&&I<1.01){D[4]=Math.max(Math.min(D[4],v-B.border.left),-A)}else{D[4]=Math.min(Math.max(D[4],v),-A)}if(G==="invert"||(G==="automatic"&&u<1.01)){D[5]=Math.max(Math.min(D[5],x-B.border.top),-r)}else{D[5]=Math.min(Math.max(D[5],x),-r)}}if(s.animate!=="skip"){this.transition(!s.animate)}if(s.range){this.$zoomRange.val(H)}if(this.options.disableXAxis||this.options.disableYAxis){var F=this.getMatrix();if(this.options.disableXAxis){D[4]=F[4]}if(this.options.disableYAxis){D[5]=F[5]}}this.setTransform("matrix("+D.join(",")+")");this.scale=H;this._checkPanWhenZoomed(H);if(!s.silent){this._trigger("change",D)}return D},isPanning:function(){return this.panning},transition:function(u){if(!this._transition){return}var t=u||!this.options.transition?"none":this._transition;var r=this.$set;var s=r.length;while(s--){if(c.style(r[s],"transition")!==t){c.style(r[s],"transition",t)}}},pan:function(r,u,t){if(this.options.disablePan){return}if(!t){t={}}var s=t.matrix;if(!s){s=this.getMatrix()}if(t.relative){r+=+s[4];u+=+s[5]}s[4]=r;s[5]=u;this.setMatrix(s,t);if(!t.silent){this._trigger("pan",s[4],s[5])}},zoom:function(y,r){if(typeof y==="object"){r=y;y=null}else{if(!r){r={}}}var G=c.extend({},this.options,r);if(G.disableZoom){return}var u=false;var D=G.matrix||this.getMatrix();var A=+D[0];if(typeof y!=="number"){if(G.linearZoom){y=A+(G.increment*(y?-1:1))}else{y=y?(A/(1+G.increment)):(A*(1+G.increment))}u=true}y=Math.max(Math.min(y,G.maxScale),G.minScale);var x=G.focal;if(x&&!G.disablePan){this.resetDimensions();var E=G.dims=this.dimensions;var t=x.clientX;var s=x.clientY;if(!this.isSVG){t-=(E.width/A)/2;s-=(E.height/A)/2}var w=new e(t,s,1);var B=new a(D);var v=this.parentOffset||this.$parent.offset();var F=new a(1,0,v.left-this.$doc.scrollLeft(),0,1,v.top-this.$doc.scrollTop());var z=B.inverse().x(F.inverse().x(w));var C=y/D[0];B=B.x(new a([C,0,0,C,0,0]));w=F.x(B.x(z));D[4]=+D[4]+(t-w.e(0));D[5]=+D[5]+(s-w.e(1))}D[0]=y;D[3]=typeof G.dValue==="number"?G.dValue:y;this.setMatrix(D,{animate:typeof G.animate!=="undefined"?G.animate:u,range:!G.noSetRange});if(!G.silent){this._trigger("zoom",D[0],G)}},option:function(s,t){var r;if(!s){return c.extend({},this.options)}if(typeof s==="string"){if(arguments.length===1){return this.options[s]!==undefined?this.options[s]:null}r={};r[s]=t}else{r=s}this._setOptions(r)},_setOptions:function(r){c.each(r,c.proxy(function(s,t){switch(s){case"disablePan":this._resetStyle();case"$zoomIn":case"$zoomOut":case"$zoomRange":case"$reset":case"disableZoom":case"onStart":case"onChange":case"onZoom":case"onPan":case"onEnd":case"onReset":case"eventNamespace":this._unbind()}this.options[s]=t;switch(s){case"disablePan":this._initStyle();case"$zoomIn":case"$zoomOut":case"$zoomRange":case"$reset":this[s]=t;case"disableZoom":case"onStart":case"onChange":case"onZoom":case"onPan":case"onEnd":case"onReset":case"eventNamespace":this._bind();break;case"cursor":c.style(this.elem,"cursor",t);break;case"minScale":this.$zoomRange.attr("min",t);break;case"maxScale":this.$zoomRange.attr("max",t);break;case"rangeStep":this.$zoomRange.attr("step",t);break;case"startTransform":this._buildTransform();break;case"duration":case"easing":this._buildTransition();case"transition":this.transition();break;case"panOnlyWhenZoomed":this._checkPanWhenZoomed();break;case"$set":if(t instanceof c&&t.length){this.$set=t;this._initStyle();this._buildTransform()}}},this))},_checkPanWhenZoomed:function(t){var s=this.options;if(s.panOnlyWhenZoomed){if(!t){t=this.getMatrix()[0]}var r=t<=s.minScale;if(s.disablePan!==r){this.option("disablePan",r)}}},_initStyle:function(){var r={"transform-origin":this.isSVG?"0 0":"50% 50%"};if(!this.options.disablePan){r.cursor=this.options.cursor}this.$set.css(r);var s=this.$parent;if(s.length&&!c.nodeName(this.parent,"body")){r={overflow:"hidden"};if(s.css("position")==="static"){r.position="relative"}s.css(r)}},_resetStyle:function(){this.$elem.css({"cursor":"","transition":""});this.$parent.css({"overflow":"","position":""})},_bind:function(){var A=this;var B=this.options;var u=B.eventNamespace;var v="mousedown"+u+" pointerdown"+u+" MSPointerDown"+u;var y="touchstart"+u+" "+v;var w="touchend"+u+" click"+u+" pointerup"+u+" MSPointerUp"+u;var z={};var s=this.$reset;var t=this.$zoomRange;c.each(["Start","Change","Zoom","Pan","End","Reset"],function(){var C=B["on"+this];if(c.isFunction(C)){z["panzoom"+this.toLowerCase()+u]=C}});if(!B.disablePan||!B.disableZoom){z[y]=function(D){var C;if(D.type==="touchstart"?(C=D.touches||D.originalEvent.touches)&&((C.length===1&&!B.disablePan)||C.length===2):!B.disablePan&&(D.which||D.originalEvent.which)===B.which){D.preventDefault();
D.stopPropagation();A._startMove(D,C)}};if(B.which===3){z.contextmenu=false}}this.$elem.on(z);if(s.length){s.on(w,function(C){C.preventDefault();A.reset()})}if(t.length){t.attr({step:B.rangeStep===f.defaults.rangeStep&&t.attr("step")||B.rangeStep,min:B.minScale,max:B.maxScale}).prop({value:this.getMatrix()[0]})}if(B.disableZoom){return}var x=this.$zoomIn;var r=this.$zoomOut;if(x.length&&r.length){x.on(w,function(C){C.preventDefault();A.zoom()});r.on(w,function(C){C.preventDefault();A.zoom(true)})}if(t.length){z={};z[v]=function(){A.transition(true)};z[(b?"input":"change")+u]=function(){A.zoom(+this.value,{noSetRange:true})};t.on(z)}},_unbind:function(){this.$elem.add(this.$zoomIn).add(this.$zoomOut).add(this.$reset).off(this.options.eventNamespace)},_buildTransform:function(){return this._origTransform=this.getTransform(this.options.startTransform)},_buildTransition:function(){if(this._transform){var r=this.options;this._transition=this._transform+" "+r.duration+"ms "+r.easing}},_getDistance:function(t){var s=t[0];var r=t[1];return Math.sqrt(Math.pow(Math.abs(r.clientX-s.clientX),2)+Math.pow(Math.abs(r.clientY-s.clientY),2))},_getMiddle:function(t){var s=t[0];var r=t[1];return{clientX:((r.clientX-s.clientX)/2)+s.clientX,clientY:((r.clientY-s.clientY)/2)+s.clientY}},_trigger:function(r){if(typeof r==="string"){r="panzoom"+r}this.$elem.triggerHandler(r,[this].concat(n.call(arguments,1)))},_startMove:function(F,x){if(this.panning){return}var r,y,C,G,w,J,H,v;var z=this;var u=this.options;var L=u.eventNamespace;var E=this.getMatrix();var D=E.slice(0);var K=+D[4];var I=+D[5];var s={matrix:E,animate:"skip"};var t=F.type;if(t==="pointerdown"){r="pointermove";y="pointerup"}else{if(t==="touchstart"){r="touchmove";y="touchend"}else{if(t==="MSPointerDown"){r="MSPointerMove";y="MSPointerUp"}else{r="mousemove";y="mouseup"}}}r+=L;y+=L;this.transition(true);this.panning=true;this._trigger("start",F,x);var B=function(M,N){if(N){if(N.length===2){if(C!=null){return}C=z._getDistance(N);G=+E[0];w=z._getMiddle(N);return}if(J!=null){return}if((v=N[0])){J=v.pageX;H=v.pageY}}if(J!=null){return}J=M.pageX;H=M.pageY};B(F,x);var A=function(P){var N;P.preventDefault();x=P.touches||P.originalEvent.touches;B(P,x);if(x){if(x.length===2){var M=z._getMiddle(x);var O=z._getDistance(x)-C;z.zoom(O*(u.increment/100)+G,{focal:M,matrix:E,animate:"skip"});z.pan(+E[4]+M.clientX-w.clientX,+E[5]+M.clientY-w.clientY,s);w=M;return}N=x[0]||{pageX:0,pageY:0}}if(!N){N=P}z.pan(K+N.pageX-J,I+N.pageY-H,s)};c(k).off(L).on(r,A).on(y,function(M){M.preventDefault();c(this).off(L);z.panning=false;M.type="panzoomend";z._trigger(M,E,!g(E,D))});this.panning=false}};c.Panzoom=f;c.fn.panzoom=function(v){var s,u,r,t;if(typeof v==="string"){t=[];u=n.call(arguments,1);this.each(function(){s=c.data(this,d);if(!s){t.push(undefined)}else{if(v.charAt(0)!=="_"&&typeof(r=s[v])==="function"&&(r=r.apply(s,u))!==undefined){t.push(r)}}});return t.length?(t.length===1?t[0]:t):this}return this.each(function(){new f(this,v)})};return f}));
